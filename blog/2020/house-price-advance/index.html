<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h1>Table of Contents<span class="tocSkip"></span> </h1> <div class="toc"><ul class="toc-item"> <li> <span><a href="#loading-Data" data-toc-modified-id="Loading-Data-1"><span class="toc-item-num">1  </span>Loading Data</a></span><ul class="toc-item"><li><span><a href="#declare-tasks-for-linear-regression" data-toc-modified-id="Declare-tasks-for-linear-regression-1.1"><span class="toc-item-num">1.1  </span>Declare tasks for linear regression</a></span></li></ul> </li> <li> <span><a href="#preprocessing" data-toc-modified-id="Preprocessing-2"><span class="toc-item-num">2  </span>Preprocessing</a></span><ul class="toc-item"> <li><span><a href="#null-value" data-toc-modified-id="Null-Value-2.1"><span class="toc-item-num">2.1  </span>Null Value</a></span></li> <li><span><a href="#categorical-values" data-toc-modified-id="Categorical-Values-2.2"><span class="toc-item-num">2.2  </span>Categorical Values</a></span></li> </ul> </li> <li> <span><a href="#decision-tree" data-toc-modified-id="Decision-Tree-3"><span class="toc-item-num">3  </span>Decision Tree</a></span><ul class="toc-item"><li><span><a href="#evaluation-measure" data-toc-modified-id="Evaluation-Measure-3.1"><span class="toc-item-num">3.1  </span>Evaluation Measure</a></span></li></ul> </li> <li><span><a href="#submission-file" data-toc-modified-id="Submission-File-4"><span class="toc-item-num">4  </span>Submission File</a></span></li> </ul></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">math</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span> <span class="c1"># linear algebra
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span> <span class="c1"># data processing, CSV file I/O (e.g. pd.read_csv)
</span><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="n">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>


<span class="n">pd</span><span class="p">.</span><span class="nf">set_option</span><span class="p">(</span><span class="sh">'</span><span class="s">display.max_columns</span><span class="sh">'</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div> <h1 id="loading-data">Loading Data</h1> <p><em>source: https://www.kaggle.com/c/house-prices-advanced-regression-techniques</em></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DATA</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/home/strange/shob/pywork/data/house-price-advanced-regression-KAGGLE/</span><span class="sh">'</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nTrain</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">DATA</span><span class="si">}</span><span class="s">train.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">nTest</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">DATA</span><span class="si">}</span><span class="s">test.csv</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">nTrain</span><span class="p">.</span><span class="nf">head</span><span class="p">().</span><span class="nf">to_markdown</span><span class="p">())</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|    |   Id |   MSSubClass |   MSZoning |   LotFrontage |   LotArea |   Street |   Alley |   LotShape |   LandContour |   Utilities |   LotConfig |   LandSlope |   Neighborhood |   Condition1 |   Condition2 |   BldgType |   HouseStyle |   OverallQual |   OverallCond |   YearBuilt |   YearRemodAdd |   RoofStyle |   RoofMatl |   Exterior1st |   Exterior2nd |   MasVnrType |   MasVnrArea |   ExterQual |   ExterCond |   Foundation |   BsmtQual |   BsmtCond |   BsmtExposure |   BsmtFinType1 |   BsmtFinSF1 |   BsmtFinType2 |   BsmtFinSF2 |   BsmtUnfSF |   TotalBsmtSF |   Heating |   HeatingQC |   CentralAir |   Electrical |   1stFlrSF |   2ndFlrSF |   LowQualFinSF |   GrLivArea |   BsmtFullBath |   BsmtHalfBath |   FullBath |   HalfBath |   BedroomAbvGr |   KitchenAbvGr |   KitchenQual |   TotRmsAbvGrd |   Functional |   Fireplaces |   FireplaceQu |   GarageType |   GarageYrBlt |   GarageFinish |   GarageCars |   GarageArea |   GarageQual |   GarageCond |   PavedDrive |   WoodDeckSF |   OpenPorchSF |   EnclosedPorch |   3SsnPorch |   ScreenPorch |   PoolArea |   PoolQC |   Fence |   MiscFeature |   MiscVal |   MoSold |   YrSold |   SaleType |   SaleCondition |   SalePrice |
|---:|-----:|-------------:|-----------:|--------------:|----------:|---------:|--------:|-----------:|--------------:|------------:|------------:|------------:|---------------:|-------------:|-------------:|-----------:|-------------:|--------------:|--------------:|------------:|---------------:|------------:|-----------:|--------------:|--------------:|-------------:|-------------:|------------:|------------:|-------------:|-----------:|-----------:|---------------:|---------------:|-------------:|---------------:|-------------:|------------:|--------------:|----------:|------------:|-------------:|-------------:|-----------:|-----------:|---------------:|------------:|---------------:|---------------:|-----------:|-----------:|---------------:|---------------:|--------------:|---------------:|-------------:|-------------:|--------------:|-------------:|--------------:|---------------:|-------------:|-------------:|-------------:|-------------:|-------------:|-------------:|--------------:|----------------:|------------:|--------------:|-----------:|---------:|--------:|--------------:|----------:|---------:|---------:|-----------:|----------------:|------------:|
|  0 |    1 |           60 |          3 |            65 |      8450 |        1 |       0 |          3 |             3 |           0 |           4 |           0 |              5 |            2 |            2 |          0 |            5 |             7 |             5 |        2003 |           2003 |           1 |          1 |            12 |            13 |            1 |          196 |           2 |           4 |            2 |          2 |          3 |              3 |              2 |          706 |              5 |            0 |         150 |           856 |         1 |           0 |            1 |            4 |        856 |        854 |              0 |        1710 |              1 |              0 |          2 |          1 |              3 |              1 |             2 |              8 |            6 |            0 |             2 |            1 |          2003 |              1 |            2 |          548 |            4 |            4 |            2 |            0 |            61 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        2 |     2008 |          8 |               4 |      208500 |
|  1 |    2 |           20 |          3 |            80 |      9600 |        1 |       0 |          3 |             3 |           0 |           2 |           0 |             24 |            1 |            2 |          0 |            2 |             6 |             8 |        1976 |           1976 |           1 |          1 |             8 |             8 |            2 |            0 |           3 |           4 |            1 |          2 |          3 |              1 |              0 |          978 |              5 |            0 |         284 |          1262 |         1 |           0 |            1 |            4 |       1262 |          0 |              0 |        1262 |              0 |              1 |          2 |          0 |              3 |              1 |             3 |              6 |            6 |            1 |             4 |            1 |          1976 |              1 |            2 |          460 |            4 |            4 |            2 |          298 |             0 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        5 |     2007 |          8 |               4 |      181500 |
|  2 |    3 |           60 |          3 |            68 |     11250 |        1 |       0 |          0 |             3 |           0 |           4 |           0 |              5 |            2 |            2 |          0 |            5 |             7 |             5 |        2001 |           2002 |           1 |          1 |            12 |            13 |            1 |          162 |           2 |           4 |            2 |          2 |          3 |              2 |              2 |          486 |              5 |            0 |         434 |           920 |         1 |           0 |            1 |            4 |        920 |        866 |              0 |        1786 |              1 |              0 |          2 |          1 |              3 |              1 |             2 |              6 |            6 |            1 |             4 |            1 |          2001 |              1 |            2 |          608 |            4 |            4 |            2 |            0 |            42 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        9 |     2008 |          8 |               4 |      223500 |
|  3 |    4 |           70 |          3 |            60 |      9550 |        1 |       0 |          0 |             3 |           0 |           0 |           0 |              6 |            2 |            2 |          0 |            5 |             7 |             5 |        1915 |           1970 |           1 |          1 |            13 |            15 |            2 |            0 |           3 |           4 |            0 |          3 |          1 |              3 |              0 |          216 |              5 |            0 |         540 |           756 |         1 |           2 |            1 |            4 |        961 |        756 |              0 |        1717 |              1 |              0 |          1 |          0 |              3 |              1 |             2 |              7 |            6 |            1 |             2 |            5 |          1998 |              2 |            3 |          642 |            4 |            4 |            2 |            0 |            35 |             272 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        2 |     2006 |          8 |               0 |      140000 |
|  4 |    5 |           60 |          3 |            84 |     14260 |        1 |       0 |          0 |             3 |           0 |           2 |           0 |             15 |            2 |            2 |          0 |            5 |             8 |             5 |        2000 |           2000 |           1 |          1 |            12 |            13 |            1 |          350 |           2 |           4 |            2 |          2 |          3 |              0 |              2 |          655 |              5 |            0 |         490 |          1145 |         1 |           0 |            1 |            4 |       1145 |       1053 |              0 |        2198 |              1 |              0 |          2 |          1 |              4 |              1 |             2 |              9 |            6 |            1 |             4 |            1 |          2000 |              1 |            3 |          836 |            4 |            4 |            2 |          192 |            84 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |       12 |     2008 |          8 |               4 |      250000 |
</code></pre></div></div> <h2 id="declare-tasks-for-linear-regression">Declare tasks for linear regression</h2> <ol> <li>Generate correlation matrix.</li> <li>Select correlated features only</li> </ol> <h1 id="preprocessing">Preprocessing</h1> <h2 id="null-value">Null Value</h2> <p>Impute null values. If nominal, replace with most common. If continuous, replace with mean.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">imputer</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span><span class="o">==</span><span class="sh">'</span><span class="s">O</span><span class="sh">'</span><span class="p">:</span> <span class="c1"># categorical
</span>            <span class="n">imp_most</span> <span class="o">=</span> <span class="nc">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="sh">'</span><span class="s">most_frequent</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">imp_most</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">imp_most</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">imp_mean</span> <span class="o">=</span> <span class="nc">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">imp_mean</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">imp_mean</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nTrain</span> <span class="o">=</span> <span class="nf">imputer</span><span class="p">(</span><span class="n">nTrain</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">nTrain</span><span class="p">.</span><span class="nf">head</span><span class="p">())</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|    |   Id |   MSSubClass |   MSZoning |   LotFrontage |   LotArea |   Street |   Alley |   LotShape |   LandContour |   Utilities |   LotConfig |   LandSlope |   Neighborhood |   Condition1 |   Condition2 |   BldgType |   HouseStyle |   OverallQual |   OverallCond |   YearBuilt |   YearRemodAdd |   RoofStyle |   RoofMatl |   Exterior1st |   Exterior2nd |   MasVnrType |   MasVnrArea |   ExterQual |   ExterCond |   Foundation |   BsmtQual |   BsmtCond |   BsmtExposure |   BsmtFinType1 |   BsmtFinSF1 |   BsmtFinType2 |   BsmtFinSF2 |   BsmtUnfSF |   TotalBsmtSF |   Heating |   HeatingQC |   CentralAir |   Electrical |   1stFlrSF |   2ndFlrSF |   LowQualFinSF |   GrLivArea |   BsmtFullBath |   BsmtHalfBath |   FullBath |   HalfBath |   BedroomAbvGr |   KitchenAbvGr |   KitchenQual |   TotRmsAbvGrd |   Functional |   Fireplaces |   FireplaceQu |   GarageType |   GarageYrBlt |   GarageFinish |   GarageCars |   GarageArea |   GarageQual |   GarageCond |   PavedDrive |   WoodDeckSF |   OpenPorchSF |   EnclosedPorch |   3SsnPorch |   ScreenPorch |   PoolArea |   PoolQC |   Fence |   MiscFeature |   MiscVal |   MoSold |   YrSold |   SaleType |   SaleCondition |   SalePrice |
|---:|-----:|-------------:|-----------:|--------------:|----------:|---------:|--------:|-----------:|--------------:|------------:|------------:|------------:|---------------:|-------------:|-------------:|-----------:|-------------:|--------------:|--------------:|------------:|---------------:|------------:|-----------:|--------------:|--------------:|-------------:|-------------:|------------:|------------:|-------------:|-----------:|-----------:|---------------:|---------------:|-------------:|---------------:|-------------:|------------:|--------------:|----------:|------------:|-------------:|-------------:|-----------:|-----------:|---------------:|------------:|---------------:|---------------:|-----------:|-----------:|---------------:|---------------:|--------------:|---------------:|-------------:|-------------:|--------------:|-------------:|--------------:|---------------:|-------------:|-------------:|-------------:|-------------:|-------------:|-------------:|--------------:|----------------:|------------:|--------------:|-----------:|---------:|--------:|--------------:|----------:|---------:|---------:|-----------:|----------------:|------------:|
|  0 |    1 |           60 |          3 |            65 |      8450 |        1 |       0 |          3 |             3 |           0 |           4 |           0 |              5 |            2 |            2 |          0 |            5 |             7 |             5 |        2003 |           2003 |           1 |          1 |            12 |            13 |            1 |          196 |           2 |           4 |            2 |          2 |          3 |              3 |              2 |          706 |              5 |            0 |         150 |           856 |         1 |           0 |            1 |            4 |        856 |        854 |              0 |        1710 |              1 |              0 |          2 |          1 |              3 |              1 |             2 |              8 |            6 |            0 |             2 |            1 |          2003 |              1 |            2 |          548 |            4 |            4 |            2 |            0 |            61 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        2 |     2008 |          8 |               4 |      208500 |
|  1 |    2 |           20 |          3 |            80 |      9600 |        1 |       0 |          3 |             3 |           0 |           2 |           0 |             24 |            1 |            2 |          0 |            2 |             6 |             8 |        1976 |           1976 |           1 |          1 |             8 |             8 |            2 |            0 |           3 |           4 |            1 |          2 |          3 |              1 |              0 |          978 |              5 |            0 |         284 |          1262 |         1 |           0 |            1 |            4 |       1262 |          0 |              0 |        1262 |              0 |              1 |          2 |          0 |              3 |              1 |             3 |              6 |            6 |            1 |             4 |            1 |          1976 |              1 |            2 |          460 |            4 |            4 |            2 |          298 |             0 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        5 |     2007 |          8 |               4 |      181500 |
|  2 |    3 |           60 |          3 |            68 |     11250 |        1 |       0 |          0 |             3 |           0 |           4 |           0 |              5 |            2 |            2 |          0 |            5 |             7 |             5 |        2001 |           2002 |           1 |          1 |            12 |            13 |            1 |          162 |           2 |           4 |            2 |          2 |          3 |              2 |              2 |          486 |              5 |            0 |         434 |           920 |         1 |           0 |            1 |            4 |        920 |        866 |              0 |        1786 |              1 |              0 |          2 |          1 |              3 |              1 |             2 |              6 |            6 |            1 |             4 |            1 |          2001 |              1 |            2 |          608 |            4 |            4 |            2 |            0 |            42 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        9 |     2008 |          8 |               4 |      223500 |
|  3 |    4 |           70 |          3 |            60 |      9550 |        1 |       0 |          0 |             3 |           0 |           0 |           0 |              6 |            2 |            2 |          0 |            5 |             7 |             5 |        1915 |           1970 |           1 |          1 |            13 |            15 |            2 |            0 |           3 |           4 |            0 |          3 |          1 |              3 |              0 |          216 |              5 |            0 |         540 |           756 |         1 |           2 |            1 |            4 |        961 |        756 |              0 |        1717 |              1 |              0 |          1 |          0 |              3 |              1 |             2 |              7 |            6 |            1 |             2 |            5 |          1998 |              2 |            3 |          642 |            4 |            4 |            2 |            0 |            35 |             272 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        2 |     2006 |          8 |               0 |      140000 |
|  4 |    5 |           60 |          3 |            84 |     14260 |        1 |       0 |          0 |             3 |           0 |           2 |           0 |             15 |            2 |            2 |          0 |            5 |             8 |             5 |        2000 |           2000 |           1 |          1 |            12 |            13 |            1 |          350 |           2 |           4 |            2 |          2 |          3 |              0 |              2 |          655 |              5 |            0 |         490 |          1145 |         1 |           0 |            1 |            4 |       1145 |       1053 |              0 |        2198 |              1 |              0 |          2 |          1 |              4 |              1 |             2 |              9 |            6 |            1 |             4 |            1 |          2000 |              1 |            3 |          836 |            4 |            4 |            2 |          192 |            84 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |       12 |     2008 |          8 |               4 |      250000 |
</code></pre></div></div> <h2 id="categorical-values">Categorical Values</h2> <p>Label encoding using sklearn</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">le</span> <span class="o">=</span> <span class="nc">LabelEncoder</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">labelEncode</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    params: dataframe
    returns: dataframe. classes, label encoder classes in a dict with column names as keys
    </span><span class="sh">"""</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span> <span class="o">==</span> <span class="sh">'</span><span class="s">O</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">le</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="n">classes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="p">.</span><span class="n">classes_</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span><span class="n">classes</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nTrain</span><span class="p">,</span><span class="n">labelClasses</span> <span class="o">=</span> <span class="nf">labelEncode</span><span class="p">(</span><span class="n">nTrain</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">nTrain</span><span class="p">.</span><span class="nf">head</span><span class="p">())</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|    |   Id |   MSSubClass |   MSZoning |   LotFrontage |   LotArea |   Street |   Alley |   LotShape |   LandContour |   Utilities |   LotConfig |   LandSlope |   Neighborhood |   Condition1 |   Condition2 |   BldgType |   HouseStyle |   OverallQual |   OverallCond |   YearBuilt |   YearRemodAdd |   RoofStyle |   RoofMatl |   Exterior1st |   Exterior2nd |   MasVnrType |   MasVnrArea |   ExterQual |   ExterCond |   Foundation |   BsmtQual |   BsmtCond |   BsmtExposure |   BsmtFinType1 |   BsmtFinSF1 |   BsmtFinType2 |   BsmtFinSF2 |   BsmtUnfSF |   TotalBsmtSF |   Heating |   HeatingQC |   CentralAir |   Electrical |   1stFlrSF |   2ndFlrSF |   LowQualFinSF |   GrLivArea |   BsmtFullBath |   BsmtHalfBath |   FullBath |   HalfBath |   BedroomAbvGr |   KitchenAbvGr |   KitchenQual |   TotRmsAbvGrd |   Functional |   Fireplaces |   FireplaceQu |   GarageType |   GarageYrBlt |   GarageFinish |   GarageCars |   GarageArea |   GarageQual |   GarageCond |   PavedDrive |   WoodDeckSF |   OpenPorchSF |   EnclosedPorch |   3SsnPorch |   ScreenPorch |   PoolArea |   PoolQC |   Fence |   MiscFeature |   MiscVal |   MoSold |   YrSold |   SaleType |   SaleCondition |   SalePrice |
|---:|-----:|-------------:|-----------:|--------------:|----------:|---------:|--------:|-----------:|--------------:|------------:|------------:|------------:|---------------:|-------------:|-------------:|-----------:|-------------:|--------------:|--------------:|------------:|---------------:|------------:|-----------:|--------------:|--------------:|-------------:|-------------:|------------:|------------:|-------------:|-----------:|-----------:|---------------:|---------------:|-------------:|---------------:|-------------:|------------:|--------------:|----------:|------------:|-------------:|-------------:|-----------:|-----------:|---------------:|------------:|---------------:|---------------:|-----------:|-----------:|---------------:|---------------:|--------------:|---------------:|-------------:|-------------:|--------------:|-------------:|--------------:|---------------:|-------------:|-------------:|-------------:|-------------:|-------------:|-------------:|--------------:|----------------:|------------:|--------------:|-----------:|---------:|--------:|--------------:|----------:|---------:|---------:|-----------:|----------------:|------------:|
|  0 |    1 |           60 |          3 |            65 |      8450 |        1 |       0 |          3 |             3 |           0 |           4 |           0 |              5 |            2 |            2 |          0 |            5 |             7 |             5 |        2003 |           2003 |           1 |          1 |            12 |            13 |            1 |          196 |           2 |           4 |            2 |          2 |          3 |              3 |              2 |          706 |              5 |            0 |         150 |           856 |         1 |           0 |            1 |            4 |        856 |        854 |              0 |        1710 |              1 |              0 |          2 |          1 |              3 |              1 |             2 |              8 |            6 |            0 |             2 |            1 |          2003 |              1 |            2 |          548 |            4 |            4 |            2 |            0 |            61 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        2 |     2008 |          8 |               4 |      208500 |
|  1 |    2 |           20 |          3 |            80 |      9600 |        1 |       0 |          3 |             3 |           0 |           2 |           0 |             24 |            1 |            2 |          0 |            2 |             6 |             8 |        1976 |           1976 |           1 |          1 |             8 |             8 |            2 |            0 |           3 |           4 |            1 |          2 |          3 |              1 |              0 |          978 |              5 |            0 |         284 |          1262 |         1 |           0 |            1 |            4 |       1262 |          0 |              0 |        1262 |              0 |              1 |          2 |          0 |              3 |              1 |             3 |              6 |            6 |            1 |             4 |            1 |          1976 |              1 |            2 |          460 |            4 |            4 |            2 |          298 |             0 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        5 |     2007 |          8 |               4 |      181500 |
|  2 |    3 |           60 |          3 |            68 |     11250 |        1 |       0 |          0 |             3 |           0 |           4 |           0 |              5 |            2 |            2 |          0 |            5 |             7 |             5 |        2001 |           2002 |           1 |          1 |            12 |            13 |            1 |          162 |           2 |           4 |            2 |          2 |          3 |              2 |              2 |          486 |              5 |            0 |         434 |           920 |         1 |           0 |            1 |            4 |        920 |        866 |              0 |        1786 |              1 |              0 |          2 |          1 |              3 |              1 |             2 |              6 |            6 |            1 |             4 |            1 |          2001 |              1 |            2 |          608 |            4 |            4 |            2 |            0 |            42 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        9 |     2008 |          8 |               4 |      223500 |
|  3 |    4 |           70 |          3 |            60 |      9550 |        1 |       0 |          0 |             3 |           0 |           0 |           0 |              6 |            2 |            2 |          0 |            5 |             7 |             5 |        1915 |           1970 |           1 |          1 |            13 |            15 |            2 |            0 |           3 |           4 |            0 |          3 |          1 |              3 |              0 |          216 |              5 |            0 |         540 |           756 |         1 |           2 |            1 |            4 |        961 |        756 |              0 |        1717 |              1 |              0 |          1 |          0 |              3 |              1 |             2 |              7 |            6 |            1 |             2 |            5 |          1998 |              2 |            3 |          642 |            4 |            4 |            2 |            0 |            35 |             272 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |        2 |     2006 |          8 |               0 |      140000 |
|  4 |    5 |           60 |          3 |            84 |     14260 |        1 |       0 |          0 |             3 |           0 |           2 |           0 |             15 |            2 |            2 |          0 |            5 |             8 |             5 |        2000 |           2000 |           1 |          1 |            12 |            13 |            1 |          350 |           2 |           4 |            2 |          2 |          3 |              0 |              2 |          655 |              5 |            0 |         490 |          1145 |         1 |           0 |            1 |            4 |       1145 |       1053 |              0 |        2198 |              1 |              0 |          2 |          1 |              4 |              1 |             2 |              9 |            6 |            1 |             4 |            1 |          2000 |              1 |            3 |          836 |            4 |            4 |            2 |          192 |            84 |               0 |           0 |             0 |          0 |        2 |       2 |             2 |         0 |       12 |     2008 |          8 |               4 |      250000 |
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nTest</span> <span class="o">=</span> <span class="nf">imputer</span><span class="p">(</span><span class="n">nTest</span><span class="p">)</span>
<span class="n">nTest</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="nf">labelEncode</span><span class="p">(</span><span class="n">nTest</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rounded</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span><span class="n">thresh</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">corr</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">corr</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span> <span class="ow">or</span> <span class="n">corr</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;=-</span><span class="n">thresh</span> <span class="k">else</span> <span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">corr</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">corr</span> <span class="o">=</span> <span class="n">nTrain</span><span class="p">.</span><span class="nf">corr</span><span class="p">()</span>
<span class="c1"># corr = rounded(corr,0.7)
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

</code></pre></div></div> <p><img src="../../assets/images/house-price-advance-heatmap.png" alt="heatmap"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># select features
</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">YearRemodAdd</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">SaleCondition</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">PoolArea</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">LotShape</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">OverallQual</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ExterQual</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">BsmtQual</span><span class="sh">'</span><span class="p">,</span> \
       <span class="sh">'</span><span class="s">TotalBsmtSF</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">HeatingQC</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">1stFlrSF</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">FullBath</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">GrLivArea</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">KitchenQual</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">GarageCars</span><span class="sh">'</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">nTrain</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nTrain</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">]</span>
<span class="n">testX</span> <span class="o">=</span> <span class="n">nTest</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1460, 14) (1460,)
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trainX</span><span class="p">,</span><span class="n">valX</span><span class="p">,</span><span class="n">trainy</span><span class="p">,</span><span class="n">valy</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">trainX</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span><span class="n">trainy</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span><span class="n">valX</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span><span class="n">valy</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(876, 14) (876,) 
 (584, 14) (584,)
</code></pre></div></div> <h1 id="decision-tree">Decision Tree</h1> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="nc">DecisionTreeRegressor</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="sh">'</span><span class="s">mae</span><span class="sh">'</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">splitter</span><span class="o">=</span><span class="sh">'</span><span class="s">random</span><span class="sh">'</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span><span class="n">trainy</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">valX</span><span class="p">,</span><span class="n">valy</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span><span class="n">trainy</span><span class="p">))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.7333262120423661
0.8768585202914994
</code></pre></div></div> <h2 id="evaluation-measure">Evaluation Measure</h2> <p><em>Log Root Mean Squared Error</em> is used in the competitions.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">log_rmse</span><span class="p">(</span><span class="n">ytrue</span><span class="p">,</span><span class="n">ypred</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ytrue</span><span class="p">)):</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="nf">pow</span><span class="p">((</span><span class="n">math</span><span class="p">.</span><span class="nf">log2</span><span class="p">(</span><span class="n">ypred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="n">math</span><span class="p">.</span><span class="nf">log2</span><span class="p">(</span><span class="n">ytrue</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="nb">sum</span><span class="o">/</span><span class="nf">float</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ytrue</span><span class="p">))))</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yhat</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">valX</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">log_rmse</span><span class="p">(</span><span class="n">valy</span><span class="p">,</span><span class="n">yhat</span><span class="p">))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.3138365972186103
</code></pre></div></div> <h1 id="submission-file">Submission File</h1> <p>Running the fitted model on Test Set to generate house prices and submit to Kaggle</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yhat</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sub_file</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">:</span><span class="n">nTest</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">:</span><span class="n">yhat</span><span class="p">})</span>
<span class="n">sub_file</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">DATA</span><span class="si">}</span><span class="s">submission.csv</span><span class="sh">'</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div> </body></html>